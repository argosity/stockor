!function(e,t,n,r,o,s,i,a,c,p){var d,l,u;u=function(e){return!!e[2]},l=function(e,t,r){var o,s,i;return i=t[1],n.isArray(r.syncOptions["with"])?n.reduce(i,function(t,n){return t+n[e]},0):(s=r.syncOptions["with"].with_category_details,o=n.find(i,function(e){return e.category_id=s}),(null!=o?o[e]:void 0)||0)},d={id:"balance",title:"Balance",fixedWidth:100,textAlign:"right",query:!1,format:function(t,n,r){return e.u.format.currency(l("balance",n,r))}},t.Screens.ExpenseEntry=function(){function r(){}return r.prototype.displayName="Skr.Screens.ExpenseEntry",r.prototype.FILE=a,r.prototype.getInitialState=function(){return{isReviewing:!1}},r.prototype.syncOptions={include:["categories","attachments"]},r.prototype.modelBindings={categories:function(){return t.Models.ExpenseCategory.Collection.fetch()},entry:function(){return this.loadOrCreateModel({syncOptions:this.syncOptions,klass:t.Models.ExpenseEntry,prop:"entry",attribute:"id"})},query:function(){return new e.Models.Query({autoRetrieve:!0,sortAscending:!1,src:t.Models.ExpenseEntry,syncOptions:n.extend({},this.syncOptions,{"with":["with_category_details"]}),fields:[{id:"id",visible:!1},{id:"category_list",visible:!1},{id:"gl_transaction_ids",visible:!1},{id:"occured",fixedWidth:200,textAlign:"center",format:e.u.format.dateTime},{id:"name",flex:1},{id:"amount",fixedWidth:100,textAlign:"right",query:!1,format:function(t,n,r){return e.u.format.currency(l("amount",n,r))}}]})}},r.prototype.getSelectionAttributes=function(e){var t;return t=e.row,u(t)?{checked:!0,disabled:!0}:{}},r.prototype.setReviewState=function(e){return this.isReviewing=e,this.setState({isReviewing:this.isReviewing}),this.query.syncOptions["with"]=["with_category_details"],this.isReviewing?(this.query.syncOptions.queryParams={review:!0},this.query.syncOptions["with"].push("with_user_logins"),this.query.fields.add({id:"created_by_user.login",title:"User",fixedWidth:120},{at:3}),this.gridSelections=new o.Grid.Selections({onChange:this.rowSelectChanged,attributesGetter:this.getSelectionAttributes}),this.query.fields.add(this.gridSelections,{at:2})):(delete this.query.syncOptions.queryParams,delete this.gridSelections,this.query.fields.remove(["selected","created_by_user.login"])),this.query.results.reload()},r.prototype.rowSelectChanged=function(){return this.forceUpdate()},r.prototype.onEntrySelect=function(e,t){return e.fetch(this.syncOptions).then(function(t){return function(n){return t.modelBindings.reset({entry:e}),t.query.markModified(),t.refs.form.focus()}}(this))},r.prototype.onEntryReset=function(){var e;return e=new t.Models.ExpenseEntry,e.categories.add({}),this.modelBindings.reset({entry:e}),this.refs.form.focus()},r.prototype.onCategoryChange=function(){return this.query.results.reload()},r.prototype.onEntrySave=function(){var e,t;return t=this.entry.isNew(),e=this.entry.categories.isDirty(),this.entry.save().then(function(n){return function(){return n.entry.hasErrors?void 0:(t||e?n.query.results.reload():n.query.results.saveModelChanges(n.entry),n.onEntryReset())}}(this))},r.prototype.onConfirmationToggle=function(e){return this.query.results.eachRow(function(t,n){return o.Grid.Selections.setRow(t,n,e)}),this.query.markModified()},r.prototype.onApproved=function(){return this.refs.overlay.hide(),this.query.results.reload()},r.prototype.selectedState=function(){var e,t;return t=e=!0,this.query.results.eachRow(function(n,r){return o.Grid.Selections.isSelected(n,r)&&!u(n)?t=!1:e=!1,t===!1&&e===!1?"break":void 0}),e?!0:t?!1:null},r.prototype.onCategorySelect=function(e){return e?(this.query.syncOptions["with"]={with_category_details:e.id},this.query.fields.add(d)):(this.query.fields.remove(d.id),e=new t.Models.ExpenseCategory,this.query.syncOptions["with"]=["with_category_details"]),this.setState({category:e}),this.query.results.reload()},r.prototype.isRowEditing=function(e){return this.entry.id===e[0]},r.prototype.render=function(){var e;return e=this.selectedState(),s.createElement(o.ScreenWrapper,{flexVertical:!0,identifier:"expense-entry",className:n.classnames({"is-reviewing":this.isReviewing})},s.createElement(t.Screens.ExpenseEntry.Form,{ref:"form",categories:this.categories,entry:this.entry,onEntryReset:this.onEntryReset,onEntrySave:this.onEntrySave}),s.createElement(t.Screens.ExpenseEntry.Grid,{onCategorySelect:this.onCategorySelect,setReviewState:this.setReviewState,isReviewing:this.isReviewing,isRowFocused:this.isRowEditing,isConfirmationChecked:e,categories:this.categories,onRecordSelect:this.onEntrySelect,onConfirmationToggle:this.onConfirmationToggle,query:this.query}),s.createElement(i.Row,{className:"footer"},s.createElement(i.Col,{sm:12},s.createElement(i.OverlayTrigger,{rootClose:!0,container:this,trigger:"click",ref:"overlay",placement:"top",overlay:s.createElement(t.Screens.ExpenseEntry.Approve,{query:this.query,onApproved:this.onApproved})},s.createElement(i.Button,{bsStyle:"primary",disabled:e===!1},"Approve")))))},r}(),t.Screens.ExpenseEntry=t.Screens.Base.extend(t.Screens.ExpenseEntry)}(window.Lanes=window.Lanes||{},window.Lanes?window.Lanes.Skr:null,(window.Lanes.Vendor=window.Lanes.Vendor||{}).ld,window.Lanes.Skr.Components,window.Lanes.Components,window.Lanes.Vendor.React,window.Lanes.Vendor.ReactBootstrap,{namespace:window.Lanes.Skr,extension:{name:"Skr",identifier:"skr"},path:["skr","screens","expense-entry","ExpenseEntry"]},window),function(e,t,n,r,o,s,i,a,c,p){var d;d=function(){function e(){}return e.prototype.displayName="Attachments",e.prototype.FILE=a,e.prototype.modelBindings={attachments:"props"},e.prototype.render=function(){return s.createElement(o.FieldSet,{title:"Attachments ("+(this.attachments.length-1)+")"},s.createElement(o.AssetsListing,{assets:this.attachments,name:"attachments",size:"thumb"}))},e}(),d=e.React.Component.extend(d),t.Screens.ExpenseEntry.Form=function(){function r(){}return r.prototype.displayName="Skr.Screens.ExpenseEntry.Form",r.prototype.FILE=a,r.prototype.propTypes={onEntrySave:s.PropTypes.func.isRequired},r.prototype.modelBindings={entry:"props"},r.prototype.getInitialState=function(){return{isEditing:!0}},r.prototype.mixins=[e.React.Mixins.RelayEditingState],r.prototype.focus=function(){return n.defer(function(e){return function(){return e.refs.name.focus()}}(this))},r.prototype.render=function(){return s.createElement("div",{className:"form"},s.createElement(o.NetworkActivityOverlay,{model:this.entry}),s.createElement(i.Row,null,s.createElement(o.Input,{sm:8,name:"name",ref:"name",model:this.entry}),s.createElement(t.Screens.ExpenseEntry.Categories,{categories:this.props.categories,entry:this.entry,sm:4})),s.createElement(i.Row,null,s.createElement(d,{attachments:this.entry.attachments})),s.createElement(i.Row,null,s.createElement(o.Input,{sm:10,name:"memo",model:this.entry}),s.createElement(o.FormGroup,{className:"controls",sm:2},s.createElement(i.ButtonGroup,null,s.createElement(i.Button,{tabIndex:-1,onClick:this.props.onEntryReset},"Reset"),s.createElement(i.Button,{onClick:this.props.onEntrySave},"Save")))))},r}(),t.Screens.ExpenseEntry.Form=e.React.Component.extend(t.Screens.ExpenseEntry.Form)}(window.Lanes=window.Lanes||{},window.Lanes?window.Lanes.Skr:null,(window.Lanes.Vendor=window.Lanes.Vendor||{}).ld,window.Lanes.Skr.Components,window.Lanes.Components,window.Lanes.Vendor.React,window.Lanes.Vendor.ReactBootstrap,{namespace:window.Lanes.Skr,extension:{name:"Skr",identifier:"skr"},path:["skr","screens","expense-entry","Form"]},window),function(e,t,n,r,o,s,i,a,c,p){t.Screens.ExpenseEntry.Grid=function(){function n(){}return n.prototype.displayName="Skr.Screens.ExpenseEntry.Grid",n.prototype.FILE=a,n.prototype.propTypes={onRecordSelect:s.PropTypes.func.isRequired},n.prototype.modelBindings={categories:"props",query:"props"},n.prototype.getInitialState=function(){return{category:new t.Models.ExpenseCategory}},n.prototype.getCurrentCategory=function(){return this.state.category},n.prototype.renderReviewCheckbox=function(){var t;return e.current_user.roles.includes("accounting")?s.createElement(i.Checkbox,{className:"all-users",checked:!!(null!=(t=this.query.syncOptions.queryParams)?t.review:void 0),onChange:function(e){return function(t){return e.props.setReviewState(t.target.checked)}}(this)}," Review"):null},n.prototype.renderApproveToggle=function(){return this.props.isReviewing?s.createElement("span",{className:"approved-toggle"},s.createElement(o.IndeterminateCheckbox,{checked:this.props.isConfirmationChecked,onChange:function(e){return function(t){return e.props.onConfirmationToggle(t.target.checked)}}(this)})):null},n.prototype.toolbarControls=function(){return s.createElement(i.Navbar.Form,{className:"controls"},this.renderApproveToggle(),s.createElement("div",{className:"spacer"}),s.createElement("div",{className:"right"},this.renderReviewCheckbox(),s.createElement(r.ExpenseCategoryFinder,{choices:this.categories.models,fetchOnSelect:!1,withClearBtn:!0,fieldOnly:!0,editOnly:!0,selectField:!0,unlabeled:!0,model:this.state.category,getSelection:this.getCurrentCategory,setSelection:this.props.onCategorySelect})))},n.prototype.render=function(){return s.createElement(o.Grid,{expandY:!0,onColumnClick:this.onColumnSort,isRowFocused:this.props.isRowFocused,query:this.query,height:200,autoLoadQuery:!0,onSelectionChange:this.props.onRecordSelect,toolbarChildren:this.toolbarControls()})},n}(),t.Screens.ExpenseEntry.Grid=e.React.Component.extend(t.Screens.ExpenseEntry.Grid)}(window.Lanes=window.Lanes||{},window.Lanes?window.Lanes.Skr:null,(window.Lanes.Vendor=window.Lanes.Vendor||{}).ld,window.Lanes.Skr.Components,window.Lanes.Components,window.Lanes.Vendor.React,window.Lanes.Vendor.ReactBootstrap,{namespace:window.Lanes.Skr,extension:{name:"Skr",identifier:"skr"},path:["skr","screens","expense-entry","Grid"]},window),function(e,t,n,r,o,s,i,a,c,p){var d,l;l=function(){function t(){}return t.prototype.displayName="TextCategory",t.prototype.FILE=a,t.prototype.modelBindings={category:"props"},t.prototype.render=function(){var t;return t=this.props.categories.get(this.category.category_id).code,s.createElement("span",{className:"pair"},e.u.format.currency(this.category.amount)," ",t)},t}(),l=e.React.Component.extend(l),d=function(){function e(){}return e.prototype.displayName="Category",e.prototype.FILE=a,e.prototype.modelBindings={category:"props"},e.prototype["delete"]=function(){return this.props.onEntryDestroy(this.props.category)},e.prototype.render=function(){return s.createElement("div",{className:"category"},s.createElement(r.ExpenseCategoryFinder,{selectField:!0,choices:this.props.categories.models,fetchOnSelect:!1,model:this.category,name:"category"}),s.createElement(o.NumberInput,{name:"amount",model:this.category,align:"right"}),s.createElement(i.Button,{className:"delete",onClick:this["delete"]},s.createElement(o.Icon,{type:"trash-o",lg:!0})))},e}(),d=e.React.Component.extend(d),t.Screens.ExpenseEntry.Categories=function(){function e(){}return e.prototype.displayName="Skr.Screens.ExpenseEntry.Categories",e.prototype.FILE=a,e.prototype.modelBindings={entry:"props",categories:"props",entryCategories:function(){return this.props.entry.categories.isEmpty()&&this.props.entry.categories.add({}),this.props.entry.categories}},e.prototype.addCategory=function(){return this.entry.categories.add({}),this.setState({overlayShown:!0}),n.defer(function(e){return function(){return n.dom(e,".popover-content .category:last-child .select input").focus()}}(this))},e.prototype.onMultiClick=function(){return this.setState({overlayShown:!0})},e.prototype.getPopOverTarget=function(){return n.dom(this.refs.overlayTarget).el},e.prototype.onEntryDestroy=function(e){return this.setState({overlayShown:!1}),this.props.entry.categories.remove(e)},e.prototype.renderMultiple=function(){var e,t;return e=this.entry.categories.map(function(e){return function(t){return s.createElement(d,{key:t.cid,category:t,onEntryDestroy:e.onEntryDestroy,categories:e.props.categories})}}(this)),t=this.entry.categories.map(function(e){return function(t){var n;return n=e.categories.get(t.category_id),n?s.createElement(l,{key:t.cid,category:t,categories:e.categories}):null}}(this)),s.createElement(i.Col,{sm:12,className:"multiple"},s.createElement(i.FormGroup,null,s.createElement(i.ControlLabel,null,"Categories"),s.createElement("div",{className:"controls"},s.createElement(i.FormControl.Static,{onClick:this.onMultiClick},t),s.createElement(o.IconButton,{icon:"edit",className:"view",ref:"overlayTarget",onClick:function(e){return function(){return e.setState({overlayShown:!0})}}(this)}),s.createElement(i.Overlay,{show:this.state.overlayShown,rootClose:!0,onHide:function(e){return function(){return e.setState({overlayShown:!1})}}(this),placement:"bottom",container:this,target:this.getPopOverTarget},s.createElement(i.Popover,{id:"popover-positioned-bottom",title:"Entries"},e)))))},e.prototype.render=function(){var e,t;return e=function(){switch(this.entry.categories.length){case 1:return s.createElement(d,{category:this.entry.categories.first(),categories:this.props.categories});default:return this.renderMultiple()}}.call(this),t=n.without(this.props,n.keys(this.constructor.propTypes)),s.createElement(i.Col,Object.assign({},t,{className:"categories"}),e,s.createElement(i.FormGroup,{className:"add"},s.createElement(o.IconButton,{icon:"plus",onClick:this.addCategory})))},e}(),t.Screens.ExpenseEntry.Categories=e.React.Component.extend(t.Screens.ExpenseEntry.Categories)}(window.Lanes=window.Lanes||{},window.Lanes?window.Lanes.Skr:null,(window.Lanes.Vendor=window.Lanes.Vendor||{}).ld,window.Lanes.Skr.Components,window.Lanes.Components,window.Lanes.Vendor.React,window.Lanes.Vendor.ReactBootstrap,{namespace:window.Lanes.Skr,extension:{name:"Skr",identifier:"skr"},path:["skr","screens","expense-entry","Categories"]},window),function(e,t,n,r,o,s,i,a,c,p){t.Screens.ExpenseEntry.ApprovalRequest=function(){function e(){e.__super__.constructor.apply(this,arguments)}return e.prototype.FILE=a,e.prototype.props={bank_account_id:{type:"integer"},expense_ids:{type:"array","default":function(){return[]}}},e.prototype.api_path=function(){return"/skr/expense-entries/approve"},e.prototype.associations={bank_account:{model:"BankAccount"}},e.prototype.isValid=function(){return!!this.bank_account_id},e}(),e.Models.Base.extend(t.Screens.ExpenseEntry.ApprovalRequest)}(window.Lanes=window.Lanes||{},window.Lanes?window.Lanes.Skr:null,(window.Lanes.Vendor=window.Lanes.Vendor||{}).ld,window.Lanes.Skr.Components,window.Lanes.Components,window.Lanes.Vendor.React,window.Lanes.Vendor.ReactBootstrap,{namespace:window.Lanes.Skr,extension:{name:"Skr",identifier:"skr"},path:["skr","screens","expense-entry","ApprovalRequest"]},window),function(e,t,n,r,o,s,i,a,c,p){t.Screens.ExpenseEntry.Approve=function(){function e(){}return e.prototype.displayName="Skr.Screens.ExpenseEntry.Approve",e.prototype.FILE=a,e.prototype.modelBindings={approvalRequest:function(){return new t.Screens.ExpenseEntry.ApprovalRequest},query:"props"},e.prototype.approveSelected=function(){return this.approvalRequest.expense_ids=[],this.query.results.eachRow(function(e){return function(t,n){return o.Grid.Selections.isSelected(t,n)?e.approvalRequest.expense_ids.push(e.query.results.idForRow(t)):void 0}}(this)),this.approvalRequest.save().then(this.props.onApproved)},e.prototype.render=function(){var e;return e=n.omit(this.props,"query","onApproved"),s.createElement(i.Popover,Object.assign({},e,{id:"choose-bank-account",title:"Choose bank account"}),s.createElement(r.BankAccountFinder,{selectField:!0,fieldOnly:!0,editOnly:!0,model:this.approvalRequest,name:"bank_account"}),s.createElement(i.Button,{disabled:!this.approvalRequest.isValid(),bsStyle:"success",onClick:this.approveSelected},"Approve"))},e}(),t.Screens.ExpenseEntry.Approve=e.React.Component.extend(t.Screens.ExpenseEntry.Approve)}(window.Lanes=window.Lanes||{},window.Lanes?window.Lanes.Skr:null,(window.Lanes.Vendor=window.Lanes.Vendor||{}).ld,window.Lanes.Skr.Components,window.Lanes.Components,window.Lanes.Vendor.React,window.Lanes.Vendor.ReactBootstrap,{namespace:window.Lanes.Skr,extension:{name:"Skr",identifier:"skr"},path:["skr","screens","expense-entry","ApproveDialog"]},window);