!function(e,t,n,r,o,i,s,a,c,l){var u,d;t.Screens.TimeInvoicing=function(){function c(){}return c.prototype.displayName="Skr.Screens.TimeInvoicing",c.prototype.FILE=a,c.prototype.getInitialState=function(){return{isEditing:!0,commands:new t.Screens.Commands(this,{modelName:"request"})}},c.prototype.dataObjects={request:function(){return new u},query:function(){return this.gridSelections=new o.Grid.Selections({onChange:this.updateTotal}),new e.Models.Query({defaultSort:"start_at",src:t.Models.TimeEntry,fields:[{id:"id",visible:!1},this.gridSelections,{id:"start_at",fixedWidth:200,format:e.u.format.shortDateTime},{id:"end_at",fixedWidth:200,format:e.u.format.shortDateTime},{id:"hours",fixedWidth:80,textAlign:"center",editable:!1,query:!1,format:function(e,t){return d(t)}},{id:"description",flex:1}]})}},c.prototype.setDataState=function(e){return this.updateTotal(),this.setState(e)},c.prototype.updateTotal=function(){var e,t,r,o,i;return i=n.bigDecimal("0"),(e=null!=(t=this.request.customer_project.rates)?t.hourly:void 0)?(r=0,this.query.results.eachRow(function(t,n){return n&&!1===n.selected?void 0:(r+=1,i=i.add(d(t)*e))}),o=r===this.query.results.length?"all":r?"some":"none",this.setState({total:i,selectionState:o})):void 0},c.prototype.editors=function(){return{selected:function(e){var t,n,r,o;return t=e.query,n=e.rowIndex,o=t.results.xtraData(n),r=!1!==o.selected,i.createElement("input",{type:"checkbox",defaultChecked:r,onChange:function(e){return o.selected=e.target.checked}})}}},c.prototype.onModelSet=function(e){return this.request.set({customer_project:e}),this.query.syncOptions={query:{customer_project_id:e.id,is_invoiced:!1}},this.query.results.reload()},c.prototype.createInvoice=function(){var e;return e=this.query.idIndex,this.request.time_entry_ids=[],this.query.results.eachRow(function(t){return function(n,r){return r&&!1===r.selected?void 0:t.request.time_entry_ids.push(n[e])}}(this)),this.request.save({saveAll:!0}).then(function(e){return function(t){return e.query.results.reload(),e.context.viewport.displayModal(e.displayInvoiceResults(t))}}(this))},c.prototype.displayInvoiceResults=function(e){return{title:"Invoice created \u2026",buttons:[{title:"OK",style:"primary"}],autoHide:!0,body:function(t){return function(){return i.createElement("h3",null,"Invoice # ",i.createElement(r.InvoiceLink,{invoice:e.invoice,onClick:function(){return t.context.viewport.hideModal()}})," was successfully created.")}}(this)}},c.prototype.setNewEntriesProject=function(e){return e.set({customer_project:this.request.customer_project})},c.prototype.onSelectAll=function(){var e;return e=this.query.results,e.eachRow(function(t){var n;return n=e.xtraData(t),n.selected=!1===n.selected}),this.query.changeCount++},c.prototype.renderToggleAllButton=function(){return 0===this.query.results.length?null:i.createElement(s.Button,{className:"navbar-btn toggle",onClick:this.onSelectAll,bsSize:"small"},i.createElement(r.TriState,{type:this.state.selectionState})," Toggle")},c.prototype.render=function(){return i.createElement(o.ScreenWrapper,{identifier:"time-invoicing",flexVertical:!0},i.createElement(s.Nav,{className:"lanes-toolbar"},i.createElement("div",{className:"spacer"}),i.createElement(s.Button,{navItem:!0,componentClass:"button",onClick:this.createInvoice,className:"save navbar-btn"},i.createElement(o.Icon,{type:"file-text"})," Create Invoice")),i.createElement(s.Row,null,i.createElement(r.CustomerProjectFinder,{name:"code",ref:"prjfinder",model:this.request.customer_project,onModelSet:this.onModelSet})),i.createElement(s.Row,{className:"flex-expand"},i.createElement(o.Grid,{query:this.query,toolbarChildren:this.renderToggleAllButton(),commands:this.state.commands,autoLoadQuery:!1,expandY:!0,columEditors:this.editors(),editorProps:{syncImmediatly:!0,beforeSave:this.setNewEntriesProject,afterSave:this.updateTotal},onSelectionChange:this.onSelectionChange,height:200,allowDelete:!0,allowCreate:!0,editor:!0})),i.createElement(s.Row,null,i.createElement(s.Col,{xsOffset:10,xs:1},i.createElement("h4",null,"Total:")),i.createElement(s.Col,{xs:1},i.createElement("h4",null,i.createElement(r.Currency,{amount:this.state.total})))))},c}(),t.Screens.TimeInvoicing=t.Screens.Base.extend(t.Screens.TimeInvoicing),d=function(e){var t,r,o,i;return o=n.isArray(e)?[e[2],e[1]]:[e.end_at,e.start_at],t=o[0],i=o[1],r=n.moment(t).diff(i,"hours",!0),Math.round(100*r)/100},u=function(){function e(){e.__super__.constructor.apply(this,arguments)}return e.prototype.FILE=a,e.prototype.props={customer_project_id:{type:"integer"},time_entry_ids:{type:"array","default":function(){return[]}}},e.prototype.api_path=function(){return"/skr/invoices/from-time-entries"},e.prototype.associations={customer_project:{model:"CustomerProject",autoCreate:!0},invoice:{model:"Invoice"}},e}(),e.Models.Base.extend(u)}(window.Lanes,window.Lanes?window.Lanes.Skr:null,window.Lanes.Vendor.ld,window.Lanes.Skr.Components,window.Lanes.Components,window.Lanes.Vendor.React,window.Lanes.Vendor.ReactBootstrap,{namespace:window.Lanes.Skr,extension:{name:"Skr",identifier:"skr"},path:["skr","screens","time-invoicing","TimeInvoicing"]},window);