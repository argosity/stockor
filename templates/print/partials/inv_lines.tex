% <% ncols = 6 %>
{\tabulinesep 0.2cm
\noindent\begin{longtabu} to \textwidth {lX<%='c'*(ncols-4) %>rr}
<%= partial 'inv_hdr.tex' %>
\hline
  \endfirsthead
  \multicolumn{<%=ncols%>}{l}{...continued from previous page} \\
<%= partial 'inv_hdr.tex' %>
  \endhead
  \hline
  \multicolumn{<%=ncols%>}{r}{Continued on next page...} \\
  \endfoot
  \hline
<%= partial @footer || 'inv_footer.tex', invoice: @invoice, ncols: ncols %>
\endlastfoot
<% if @groups %>
  <% @groups.each_with_index do | group, i | -%>
    \multicolumn{<%= ncols%>}{l}{\textbf{<%=q group[:title] %>}} \\
    \cline{1-1}
    <% group[:lines].each do | line | %>
      <%= partial 'inv_line.tex', line: line -%>
    <% end -%>
    <%= partial group[:footer] || 'inv_lines_group_footer.tex',
        invoice: @invoice, group: group, ncols: ncols %>
  <% end -%>
<% else %>
  <% @lines.each do | line | %>
    <%= partial 'inv_line.tex', line: line -%>
  <% end -%>
<% end -%>
\end{longtabu}
}
